<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>User Details</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="qrcode.js"></script>
    <script type="module" src="qr-scanner.min.js"></script>
</head>
<body>
    <script>
        $(document).ready(function(){
            var qrcode = new QRCode(document.getElementById("qrcode"), {
                width : 100,
                height : 100
            });
            var user_id, isCoordinator;
            $('#register').hide()

            var fill_details = function(jsonObj){
                $('#userDetails').append(
                    `
                    <p><strong>Username : </strong>${jsonObj['user']['username']}</p>
                    <p><strong>Phone : </strong>${jsonObj['phone']}</p>
                    <p><strong>Email : </strong>${jsonObj['user']['email']}</p>
                    <p><strong>College : </strong>${jsonObj['college']}</p>
                    `
                );
            }
            
            $.ajax({
                url: "http://localhost:8000/events/api/user-details/"+localStorage.getItem('username')+"",
                headers: {"Authorization": "Token "+localStorage.getItem('auth_token')},
                type: "GET",
                success:function(result){
                    user_id = result['id'];
                    isCoordinator = result['isCoordinator'];
                    fill_details(result);
                    if(isCoordinator) {
                        $('#register').show();
                    }
                },
                error:function(xht,status,err){
                    alert("error"+xht.resposeText);
                },
                

            });
            $('#GetQr').click(function(){
                qrcode.makeCode(user_id+"");  
            });
            $('#register').click(function(){
                const qrScanner = new QrScanner(videoElem, result => console.log('decoded qr code:', result));
            });
        });
        
    </script>
    <video></video>
    <button id="register">Register User</button>
    <div id="userDetails">
    </div>
    <button id="GetQr">Get QR</button>
    <div id="qrcode" style="width:100px; height:100px; margin-top:15px;"></div>
</body>
</html>